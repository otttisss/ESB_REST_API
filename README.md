# API для управления заказами

Этот API предоставляет эндпоинты для управления заказами. Он позволяет создавать, получать, обновлять и удалять заказы, а также интегрируется с базой данных и ActiveMQ для обмена сообщениями.

## Эндпоинты

### 1. **Создать заказ**
- **Метод:** `POST`
- **Путь:** `/orders`
- **Тело запроса:**
    ```json
    {
      "client_name": "строка",
      "amount": "число",
      "status": "строка"
    }
    ```
- **Ответ:**
    - `200 OK` при успешном выполнении
    - `400 Bad Request` если данные некорректны

### 2. **Получить заказ по ID**
- **Метод:** `GET`
- **Путь:** `/orders/{id}`
- **Параметры пути:**
    - `id` (обязательный) - ID заказа
- **Ответ:**
    - `200 OK` с данными заказа, если заказ найден:
        ```json
        {
          "id": 1,
          "client_name": "Иван Иванов",
          "amount": 100.0,
          "status": "В ожидании"
        }
        ```
    - `404 Not Found` если заказ не найден.

### 3. **Обновить статус заказа**
- **Метод:** `PUT`
- **Путь:** `/orders/{id}/status`
- **Параметры пути:**
    - `id` (обязательный) - ID заказа
- **Тело запроса:**
    ```json
    {
      "status": "строка"
    }
    ```
- **Ответ:**
    - `200 OK` с сообщением о подтверждении:
        ```json
        {
          "message": "Статус заказа обновлён"
        }
        ```
    - `400 Bad Request` если статус некорректен.

### 4. **Удалить заказ**
- **Метод:** `DELETE`
- **Путь:** `/orders/{id}`
- **Параметры пути:**
    - `id` (обязательный) - ID заказа
- **Ответ:**
    - `200 OK` при успешном удалении
    - `404 Not Found` если заказ не найден

## Конфигурация

API подключается к следующим сервисам:

1. **База данных** (PostgreSQL)
    - URL: `jdbc:postgresql://localhost:5432/orders_db`
    - Пользователь: `postgres`
    - Пароль: `1234`

2. **JMS (ActiveMQ)**
    - Пользователь: `admin`
    - Пароль: `admin`
    - Назначение: `statusQueue`

## Обработка ошибок

API включает базовую обработку ошибок:

- Если данные запроса некорректны, API вернёт `400 Bad Request` с описанием ошибки.
- В случае внутренней ошибки сервера API вернёт `500 Internal Server Error`.
- Если заказ не найден, эндпоинт `GET` вернёт статус `404 Not Found`.

## Логирование ошибок

Все ошибки и полученные сообщения логируются для диагностики и мониторинга.

## Требования

- **MuleSoft Anypoint Studio** или аналогичная среда выполнения Mule.
- **PostgreSQL** база данных с указанной схемой `orders_db`.
- **ActiveMQ** с настройками, указанными в конфигурации.

## Как запустить

1. Клонируйте или скачайте репозиторий с проектом Mule.
2. Импортируйте проект в **Anypoint Studio**.
3. Запустите ваше Mule-приложение в Anypoint Studio.
4. Убедитесь, что ваши сервисы PostgreSQL и ActiveMQ запущены.

## Тестирование

Вы можете протестировать API с помощью любого HTTP-клиента, например, **Postman** или **cURL**.

Пример запроса `POST`:
```bash
curl --location 'http://localhost:8081/orders' \
--header 'Content-Type: application/json' \
--data '{
  "client_name": "dasd",
  "amount": 10.2,
  "status": "maaaan"
}'
```
Пример запроса `GET`:
```bash
curl --location 'http://localhost:8081/orders/2'
```
Пример запроса `DELETE`:
```bash
curl --location --request DELETE 'http://localhost:8081/orders/2'
```
Пример запроса `PUT`:
```bash
curl --location --request PUT 'http://localhost:8081/orders/3/status?status=success'
```
